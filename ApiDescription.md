# Eldritch Horror Cards (API)

`root url: URL: 82.202.236.16/api/mobile_app/v1`
`root url: URL: 82.202.236.16/api/mobile_app/v2`

## Восстановление сессии


* type `get` $$
* endpoint: `v1/games/restore`
* url_params: `game_id=`

{
   {
    "data": {
        "id": "7",
        "type": "game",
        "attributes": {
            "token": "6c38346b2852c7aa79023c1f1290b92a",
            "ancient_id": null,
            "expedition_location_id": 4,
            "players_count": null,
            "game_set_identity": [],
            "state": "initiate",
            "with_map": [],
            "avaliable_card_types": []
        }
    }
}


## 1.  Пользователь нажимает на кнопку "Старт"

* type: `post`
* endpoint:  `/games`
* params example: `{ user_uid: "ЭТО ПОКА НЕ ОБЯЗАТЕЛЬНЫЙ ПАРАМЕТР" }` 
* response: 
    * id игры - он будет дальше везде подставляться в запросах
    * token игры
    * локация текущей экспедиции
``` JSON
{
    "data": {
        "id": "8",
        "type": "game",
        "attributes": {
            "token": "cc0628dbfbfed26628373d6ffa6caa58",
            "ancient_id": null,
            "expedition_location_id": 4,
            "players_count": null,
            "game_set_identity": [],
            "state": "initiate",
            "with_map": [],
            "avaliable_card_types": null
        }
    }
}
```

## 2 Показывает пользователю список доступных дополнений

* type: `get`
* endpoint `/game_sets`$$$$
* response:
    * id дополнения$$
    * идентификатор дополнения
$$
``` JSON
{
    "data": [
        {
            "id": "2",
            "type": "game_set",
            "attributes": {
                "identity": "under_the_pyramids",
                "name": "Под пирамидами",
                "description": "В незапамятные времена Египтом правил Нефрен-Ка, Тёмный фараон. Был этот царь настолько злым и жестоким, что его собственный народ уничтожил все свидетельства его правления. Однако в наши дни Братство Зверя раскрыло правду о Тёмном фараоне и замыслило вернуть его на престол, чтобы снова обречь и Египет, и всё человечество на века ужасного рабства. Вам и вашим друзьям-сыщикам предстоит не мешкая отправиться в Египет и проникнуть в самые потаённые и жуткие уголки древней страны, чтобы остановить заговорщиков и не позволить Нефрен-Ка пробудиться от вечного сна.",
                "has_map": false
            }
        },
        {
            "id": "3",
            "type": "game_set",
            "attributes": {
                "identity": "mountains_of_madness",
                "name": "Хребты безумия",
                "description": "Задолго до появления рода человеческого на Земле обитали Старцы. Эпохи назад они уснули вечным сном, уступив планету другим видам, но теперь, в 1926 году, Старцы пробуждаются вновь. Их тёмное влияние расползается по миру, подчиняя умы людей таинственной воле. Почуяв приближение катастрофы, горстка отважных сыщиков отправляется в Антарктиду, чтобы отыскать причину происходящего. Этим смелым людям суждено остановить грядущее зло — или жестоко поплатиться за дерзкую попытку.",
                "has_map": false
            }
        }, ....
    ]
}
```

## 3 Пользователь выбрал несколько дополнений

Отправляем запрос, чтобы сервер подготовил данные.

* type: `put`
* endpoint: `/games/id/[ИД игры]`
* body params: 
``` JSON
 { 
    "game": {
         "game_set_identity" : ["2", "5"],
        "with_map": ["2"]
         }
 }
```
* response: приходит техническая инфа, которая нам не нужна по сути, главное получить статус `200`.

## 4 Запрос доступных Древних

Отправив запрос 3, можно получить монстров. Если запрос 3 не отправили, придет пустой список.

* type: `get`
* enpoint: `/ancients`
* url params: `game_id=[ИД игры передаем]`
* response: список монстров
``` JSON
{
   data: [
            {
               id: "2",
               type: "ancient",
                  attributes: {
                  identity: "azathoth",
                  name: "Азатот",
                  despair: 15,
                  description: "Безумный бог восседает в центре всего сущего, распространяя безумие и смерть. Его семя      нисходит                   со звезд, угрожая расколоть мир пополам.",
                  slogan: "Султан демонов"
               },
               relationships: {
                  game_set: {
                     data: {
                        id: "1",
                        type: "game_set"
                     }
                  }
               }
            },
            {
               id: "7",
               type: "ancient",
               attributes: {
                  identity: "shub-niggurath",
                  name: "Шуб-Ниггурат",
                  despair: 13,
                  description: "Во время языческих обрядов Шуб-Ниггурат поглощает культистов и создает из них Гоф``нн Хупадх - козлиные отродья. Темная молодь появляется из самых диких уголков Земли, чтобы сокрушить человечество.",
                  slogan: "Черная Коза Чащоб"
               },
               relationships: {
                  game_set: {
                     data: {
                        id: "1",
                        type: "game_set"
                     }
                  }
                 }
               },
               {
                  id: "9",
                  type: "ancient",
                  attributes: {
                     identity: "yog-sothoth",
                     name: "Йог-Сотот",
                     despair: 14,
                     description: "Тысячелетиями чародеи прибегали к силе Йог-Сотота, чтобы подчинять себе реальность. Этот Древний одновременно присутствует во всех местах и временах, однако его сущность заключена в пространстве между измерениями. Чем чаще будут открываться порталы, тем скорее Йог-Сотот освободится из заточения.",
                     slogan: "Таящийся у порога"
                  },
                  relationships: {
                     game_set: {
                        data: {
                           id: "1",
                           type: "game_set"
                        }
                     }
                  }
            },
            {
               id: "8",
               type: "ancient",
               attributes: {
                  identity: "yig",
                  name: "Йиг",
                  despair: 10,
                  description: "Многие слышали об ужасном проклятии Йига, уготовленном для тех, кто обижает его отпрысков. Но немногим известно, что давным-давно змеиный народ предал Йига и тоже познал его гнев. Теперь люди-змеи возвращаются, чтобы покорить этот мир во имя своего истинного повелителя.",
                  slogan: "Отец всех змей"
               },
               relationships: {
                  game_set: {
                     data: {
                        id: "1",
                        type: "game_set"
                     }
                  }
               }
           },......
       ],
       included: [
         {
            id: "1",
            type: "game_set",
            attributes: {
               identity: "core",
               name: "База",
               description: null,
               has_map: false
            }
         },
         {
            id: "2",
            type: "game_set",
            attributes: {
               identity: "under_the_pyramids",
               name: "Под пирамидами",
               description: "В незапамятные времена Египтом правил Нефрен-Ка, Тёмный фараон. Был этот царь настолько злым и жестоким, что его собственный народ уничтожил все свидетельства его правления. Однако в наши дни Братство Зверя раскрыло правду о Тёмном фараоне и замыслило вернуть его на престол, чтобы снова обречь и Египет, и всё человечество на века ужасного рабства. Вам и вашим друзьям-сыщикам предстоит не мешкая отправиться в Египет и проникнуть в самые потаённые и жуткие уголки древней страны, чтобы остановить заговорщиков и не позволить Нефрен-Ка пробудиться от вечного сна.",
               has_map: true
            }
         }
      ]
   }
```

## 5 Пользователь выбирает Древнего.

* type: `put`
* endpoint: `games/[ИД ИГРЫ]`
* body params: 
``` JSON
{ 
    "game": { "ancient_id": 3 }
}
```
* response: приходит техническая инфа, которая нам не нужна по сути, главное получить статус `200`.

## 6 Показываем доступные типы карт

* type: `get`
* endpoint: `/cards`
* params:  `{ "game_id": "1" }`
* response:
``` JSON
{
    "avaliable_card_types": [
        [
            "general_contacts",                      # обычные контакты
            "other_world_contacts",                  # порталы
            "expedition_location_heart_of_africa",   #локация текущей экспедиции          
            "research_contact_abhoth",               # улики для Абхота
            "contact_in_america",                    # контакты в америке
            "contact_in_europe",                     # контакты в увропе 
            "contact_in_asia_australia",             # контакты в австралии
            "contact_in_egypt",                      # контакты в египте
            "contact_in_africa",                     # контакты в африке
            "special_contact_spawn_of_abhoth",       # специальный контакт Отродье Абхоте
            "special_contact_deep_caverns"           # спеиальный контакт глубокие пещеры
        ]
    ]
}
```

### 6.1	Пользователь выбрал обычный контакт
* type: `get`
* endpoint: `/general_contacts`
* params: `{ "game_id": "1" }
* response: 
``` JSON
{
    "data": {
        "id": "26",
        "type": "general_contact",
        "attributes": {
            "identity": "general_contact",
            "card_number": 5,
            "top_title": "Город",
            "top_text": "Подозрительный тип предлагает продать вам оружие, если не станете задавать лишних вопросов. Вы пытаетесь выяснить его истинные мотивы ({influence}). При успехе возьмите 1 случайное ОРУЖИЕ из колоды активов. При провале полицейский под прикрытием арестовывает вас: возьмите состояние «Заключение».",
            "middle_title": "Глушь",
            "middle_text": "Склон холма неестественно ровный, будто под ним скрывается какое-то сооружение. Вы ищете способ пробраться внутрь — там наверняка спрятаны древние сокровища. Можете потратить 1 улику, чтобы взять 1 артефакт.",
            "bottom_title": "Море",
            "bottom_text": "<html>По словам капитана, именно здесь когда-то произошло знаменитое кораблекрушение. Используя водолазное снаряжение, которое есть на вашем судне, вы могли бы спуститься на дно и осмотреть обломки. Можете <i>задержаться</i>, чтобы взять 1 артефакт.</html>"
        },
        "relationships": {
            "game_set": {
                "data": {
                    "id": "1",
                    "type": "game_set"
                }
            }
        }
    },
    "included": [
        {
            "id": "1",
            "type": "game_set",
            "attributes": {
                "identity": "core",
                "name": "База",
                "description": null,
                "has_map": false
            }
        }
    ]
}   "sea": "Натолкнувшись на обломки кораблекрушения, вы ищите выживших или хотя .."
}
```

### 6.2 Пользователь выбрал портал
* type: `get`
* endpoint: `/other_world_contacts`
* params: `{ "game_id": "1" }`
* response: 
``` JSON
{
    "data": {
        "id": "2",
        "type": "other_world_contact",
        "attributes": {
            "identity": "other_world_contact",
            "title": "Затеряная Каркоза",
            "initial_effect": "На изысканном маскараде вы беседуете с гостями. Каждый из этих самовлюбленных интриганов пытается сделать так, чтобы его объявили\r\n    единственным наследником короны (руки).",
            "pass_effect": "Один из гостей пытается подкупить вас: возьмите 1 артефакт.\r\n    Заметив это, королева требует, чтобы вы сняли маску. Она расспрашивает вас обо всем, что вы знаете: вы задержаны,\r\n    если не потратите 2 улки.",
            "fail_effect": "Внезапно вы осознаете, что общаетесь с Призраком Истины: потеряйте 1 рассудок. Ваш ужас только усиливается,\r\n    когда вы понимаете, что на нем нет маски (голова). При провале возьмите состояние 'Паранойя'",
            "card_number": 777
        },
        "relationships": {
            "game_set": {
                "data": {
                    "id": "1",
                    "type": "game_set"
                }
            }
        }
    },
    "included": [
        {
            "id": "1",
            "type": "game_set",
            "attributes": {
                "identity": "core",
                "name": "База",
                "description": null,
                "has_map": false
            }
        }
    ]
}```

### 6.3 Пользователь выбрал улику

* type: `get`
* endpoint: `/research_contacts`
* params: 
``` JSON
{
     "game_id": "1"
}
```

* response:
``` JSON
 {
    "data": {
        "id": "37",
        "type": "research_contact",
        "attributes": {
            "identity": "research_contact_abhoth",
            "card_number": 13,
            "top_title": "Город",
            "top_text": "Курьер доставляет письмо из Мискатоникского университета. Учёные пишут, что они выделили из останков мерзкой твари снадобье, которое поможет вам в борьбе с наступающим злом. Можете переместиться в Аркхэм и задержаться, чтобы получить эту улику и улучшить {will}.",
            "middle_title": "Глушь",
            "middle_text": "На земле и траве отпечатались следы множества: человеческих ног ({observation}-1). При успехе вы понимаете, что все они принадлежат одному чудовищному существу, и убираетесь от греха подальше: получите эту улику. При провале вы не придаёте следам значения, и на вас нападает чудовище с дюжиной ног: потеряйте 1 здоровье.",
            "bottom_title": "Море",
            "bottom_text": "Безбилетник поджёг груз, среди которого есть ящик с археологическими находками из Каира. Можете потратить 2 здоровья, чтобы спасти ящик из огня. Если сделали это, получите эту улику и возьмите 1 РЕДКИЙ артефакт."
        },
        "relationships": {
            "game_set": {
                "data": {
                    "id": "2",
                    "type": "game_set"
                }
            },
            "ancient": {
                "data": {
                    "id": "1",
                    "type": "ancient"
                }
            }
        }
    },
    "included": [
        {
            "id": "1",
            "type": "ancient",
            "attributes": {
                "identity": "abhoth",
                "name": "Абхот",
                "despair": 14,
                "description": "Абхот обитает в самом сердце горы Вуршмишадреш. Оттуда, из зловонной пещеры Й```куаа, он изрыгает своих мерзких детей, распространяя свое влияние по всей Земле.",
                "slogan": "Источник нечестивости"
            },
            "relationships": {
                "game_set": {
                    "data": {
                        "id": "2",
                        "type": "game_set"
                    }
                }
            }
        },
        {
            "id": "2",
            "type": "game_set",
            "attributes": {
                "identity": "under_the_pyramids",
                "name": "Под пирамидами",
                "description": "В незапамятные времена Египтом правил Нефрен-Ка, Тёмный фараон. Был этот царь настолько злым и жестоким, что его собственный народ уничтожил все свидетельства его правления. Однако в наши дни Братство Зверя раскрыло правду о Тёмном фараоне и замыслило вернуть его на престол, чтобы снова обречь и Египет, и всё человечество на века ужасного рабства. Вам и вашим друзьям-сыщикам предстоит не мешкая отправиться в Египет и проникнуть в самые потаённые и жуткие уголки древней страны, чтобы остановить заговорщиков и не позволить Нефрен-Ка пробудиться от вечного сна.",
                "has_map": true
            }
        }
    ]
}
```
<b>Если не созданы улики для данного Древнего:</b>
``` JSON
{
    "city": null,
    "wilderness": null,
    "sea": null
}
```

### 6.4 Пользователь выбрал экспедицию
* type: `get`
* endpoint: `/expedition_contacts`
* params: 
``` JSON 
{
  "game_id": "1"
}
```

* response:
``` JSON
{
    "data": {
        "id": "10",
        "type": "expedition_contact",
        "attributes": {
            "identity": null,
            "initial_effect": "Группа аборигенов собирается отправиться в Улуру. Когда они доберутся туда, то будут общаться с древними духами, Тьюкурпа, о нависшей над миром угрозе уничтожения. Вы осторожно следуете за ними, пытаясь оставаться незамеченным.",
            "pass_effect": "Путешествие проходит очень тяжело, она вытягивает из вас все силы.Улучшите (). Один из духов обращается к вам(-1). При успехе дух делится своей мудростью: продвиньтесь разгадке Тайны на 1. При провале он наказывает вас: возьмите состояние 'Проклятие'.",
            "fail_effect": "Аборигены ощущают ваше присутствие и погружают ваш разум в Сновидения. Возьмите состояние 'Галлюцинации'. Духи животных нападают на вас. При успехе духи довольны вами и помогают в ваших поисках: снизьте безысходность на 1.",
            "card_number": null,
            "next_expedition_location": "expedition_location_rome"
        },
        "relationships": {
            "game_set": {
                "data": null
            },
            "expedition_location": {
                "data": {
                    "id": "11",
                    "type": "expedition_location"
                }
            }
        }
    },
    "included": [
        {
            "id": "11",
            "type": "expedition_location",
            "attributes": {
                "identity": "sydney",
                "name": "Сидней"
            }
        }
    ]
}
```
<b>Если не созданы экспедиции для данной локации:</b>
```JSON
{
    "initial_effect": null,
    "pass_effect": null,
    "fail_effect": null
}
```
### 6.5 Пользователь выбирает особый контакт
* type: `get`
* endpoint: `/special_contacts`
* params: 
``` JSON 
{
  "game_id": "1",
  "contact_type": "special_contact_the_black_wind"
}
```
* response:
``` JSON
{
    "data": {
        "id": "1",
        "type": "special_contact",
        "attributes": {
            "identity": "special_contact_the_black_wind",
            "title": "the_black_wind",
            "initial_effect": "dcsdc",
            "pass_effect": "dscsdc",
            "fail_effect": "dcsdvf",
            "card_number": 1
        },
        "relationships": {
            "game_set": {
                "data": {
                    "id": "2",
                    "type": "game_set"
                }
            },
            "ancient": {
                "data": {
                    "id": "1",
                    "type": "ancient"
                }
            }
        }
    },
    "included": [
        {
            "id": "1",
            "type": "ancient",
            "attributes": {
                "identity": "syzygy",
                "name": "Сизигия",
                "despair": 13,
                "description": "Когда планеты выстраиваются в один ряд с центром Вселенной и на Землю падает тень от затмения, тварь, что жаждет пожрать все живое, рвется сквозь завесу, сдерживающую тьму.",
                "slogan": "Парад светил"
            },
            "relationships": {
                "game_set": {
                    "data": {
                        "id": "1",
                        "type": "game_set"
                    }
                }
            }
        },
        {
            "id": "2",
            "type": "game_set",
            "attributes": {
                "identity": "under_the_pyramids",
                "name": "Под пирамидами",
                "description": "В незапамятные времена Египтом правил Нефрен-Ка, Тёмный фараон. Был этот царь настолько злым и жестоким, что его собственный народ уничтожил все свидетельства его правления. Однако в наши дни Братство Зверя раскрыло правду о Тёмном фараоне и замыслило вернуть его на престол, чтобы снова обречь и Египет, и всё человечество на века ужасного рабства. Вам и вашим друзьям-сыщикам предстоит не мешкая отправиться в Египет и проникнуть в самые потаённые и жуткие уголки древней страны, чтобы остановить заговорщиков и не позволить Нефрен-Ка пробудиться от вечного сна.",
                "has_map": false
            }
        }
    ]
}
```
<b>Если еще не созданы особые контакты с данным `???` </b>
``` JSON
    "identity": null,
    "title": "",
    "initial_effect": null,
    "pass_effect": null,
    "fail_effect": null
}
```
### 6.6 Пользователь выбирает конткт в локации
* type: `get`
* endpoint: `/location_contacts`
* params: 
``` JSON 
{
  "game_id": "1",
  "contact_type": "contact_in_asia_australia"
}
```
* response:
``` JSON
{
    "data": {
        "id": "17",
        "type": "location_contact",
        "attributes": {
            "identity": "contact_in_asia_australia",
            "area": "asia_australia",
            "card_number": 31,
            "top_title": "Шанхай",
            "top_text": "Стив Костиган затевает с вами драку в баре «Три дракона» ({strength-1}). При успехе он признает поражение и дарит вам книгу, которую где-то нашёл: возьмите 1 артефакт-КНИГУ и улучшите {lore}. При провале он наносит вам такой удар, что звон у вас в ушах никак не проходит: потеряйте 1 здоровье и ухудшите {observation}.",
            "middle_title": "Токио",
            "middle_text": "Общество «Двойной лист» даёт вам в помощь группу вооружённых бойцов. Выбранный вами монстр теряет 2 здоровья. Взамен они требуют денег ({influence}). При успехе вы платите с избытком: возьмите 1 случайную УСЛУГУ из колоды активов. При провале они отбирают всю вашу наличность: ухудшите {influence}.",
            "bottom_title": "Сидней",
            "bottom_text": "Акробаты из циркового шоу братьев Вирт помогают вам в тренировках. Улучшите {strength}. Когда цирк разоряется, артисты просят вас о помощи ({influence-1}). При успехе они обучают вас кое-чему еще: улучшите 1 навык на свой выбор. При провале вы уже не верите, что способны хоть кому-то помочь: ухудшите {will}."
        },
        "relationships": {
            "game_set": {
                "data": {
                    "id": "4",
                    "type": "game_set"
                }
            }
        }
    },
    "included": [
        {
            "id": "4",
            "type": "game_set",
            "attributes": {
                "identity": "signs_of_carcosa",
                "name": "Знамения Каркозы",
                "description": "Весь мир сошёл с ума! Настоящая эпидемия безумия охватила земной шар. Свет луны лишает рассудка поэтов и художников, а таинственный спектакль сводит с ума всех, кто его посмотрел. Невыразимый пробуждается ото сна, и его проклятый город прорывается в нашу реальность. Се грядёт Затерянная Каркоза!",
                "has_map": false
            }
        }
    ]
}
```

## 7. Создание пользователя

* type: `post`
* endpoint: `/users/`
* params:
```JSON 
{
    "email": "kate@homy.gmail.com", 
    "password": "[FILTERED]", 
    "name": "kate", 
    "avatar": "file data..."
   
}
```
* response:
```JSON 
 {
    "data": {
        "id": "2",
        "type": "user",
        "attributes": {
            "email": "katekatekate@homy.gmail.com",
            "name": "kate",
            "role": "simple",
            "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.ImthdGVrYXRla2F0ZUBob215LmdtYWlsLmNvbSI.ajVFtTwfy_2ta9QZiLDGc2dyppsjVDrtK5cJvvTSfd4"
        },
        "links": {
            "avatar": null
        }
    }
}
```

## 8. Получение токена по логину-паролю   ???? Это же экшен для 

* type: `post`
* endpoint: `/users/login`
* params: 
```JSON
{ 
   "email": "email@e.ru", "password": "mysecretpassword"  
}
``` 
* response:
```JSON 
{
    "data": {
        "id": "2",
        "type": "user",
        "attributes": {
            "email": "katekatekate@homy.gmail.com",
            "name": "kate",
            "role": "simple",
            "token": null
        },
        "links": {
            "avatar": null
        }
    }
}
```

## 9. Добавить ссылку на аватар.

* type: `post`
* endpoint: `/users/login`
* params: 
```JSON
{ 
   "email": "email@e.ru", "password": "mysecretpassword"  
}
```


